(this["webpackJsonpmap-with-zones"]=this["webpackJsonpmap-with-zones"]||[]).push([[0],{16:function(e,t,n){e.exports=n(27)},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(7),i=n.n(r),s=n(14),u=n(2),c=n(3),l=n(11),d=n(10),h=n(6),p=n.n(h),m=n(1),v=n.n(m),f=n(4),y="mapbox-container-element-id",k="".concat("map-controll","__button"),g="".concat(k,"_active"),C="".concat("map-popup","__button"),b="".concat("map-popup","__input"),L="".concat("map-popup","__label"),Z="".concat("map-popup","__title"),w="".concat("map-popup","__color"),E="".concat("map-popup","__controls"),I="".concat("map-table","__title"),S="".concat("map-table","__zones"),M=function(e){var t=e.radius,n=e.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{htmlFor:"popup-input-radius",className:L},"Enter radius (km):"),o.a.createElement("br",null),o.a.createElement("input",{type:"number",id:"popup-input-radius",defaultValue:t||0,className:b,onChange:n}),o.a.createElement("br",null))},z=function(e){var t=e.children;return o.a.createElement("div",{className:"map-popup"},t)},x=function(e){var t=e.text,n=e.onClick;return o.a.createElement("button",{className:C,onClick:n,type:"button"},t||" ")},N=function(e){var t=e.radius,n=e.onChangeRadius,a=e.onClickSelect;return o.a.createElement(z,null,o.a.createElement(M,{radius:t,onChange:n}),o.a.createElement("div",{className:E},o.a.createElement(x,{text:"Select",onClick:a})))},O="dragend",P="radiusChanged",j="buttonClick",D=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this)).radiusInputId="marker-input-radius",a.radiusButtonId="marker-button-radius",a.onInputChange=function(e){a.fire(P,{radius:Number(e.target.value)})},a.onDragEnd=function(){var e=a.marker.getLngLat();a.fire(O,{lngLat:e})},a.onButtonClick=function(){a.fire(j)},a.map=e,a.marker=new p.a.Marker({draggable:!0}),a.popupContainer=document.createElement("div"),a.popup=new p.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setDOMContent(a.popupContainer),a}return Object(c.a)(n,[{key:"remove",value:function(){this.marker&&this.marker.remove(),this.popup&&this.popup.remove()}},{key:"update",value:function(e){this.marker.setLngLat(e.toArray()),this.marker.setPopup(this.popup),this.marker.addTo(this.map),this.marker.togglePopup(),this.marker.on("dragend",this.onDragEnd),i.a.render(o.a.createElement(N,{radius:1,onChangeRadius:this.onInputChange,onClickSelect:this.onButtonClick}),this.popupContainer)}}]),n}(p.a.Evented),B=n(5);function A(e){var t=R(e);if(t)return B.center(t)}function _(e){var t=A(e);if(t)return B.getCoord(t)}function R(e,t){if(!(e.length<2)){var n=B.lineString(e,{id:t});return B.cleanCoords(B.simplify(n,{tolerance:1e-5,highQuality:!0}))}}var T=function(){function e(t){Object(u.a)(this,e),this.map=t,this.layerId="radius-stroke-layer",this.sourceId="radius-stroke-source"}return Object(c.a)(e,[{key:"update",value:function(e,t){this.addSource(e,t),this.addLayer()}},{key:"addSource",value:function(e,t){var n=function(e,t){if(e&&t){var n=B.circle(e.toArray(),t);return B.polygonToLine(n)}}(t,e);if(n){var a=this.getSource();if(a)return a.setData(n);this.map.addSource(this.sourceId,{type:"geojson",data:n})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#292828","line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6],"line-dasharray":[5,3]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),U=function(){function e(t){Object(u.a)(this,e),this.layerId="radius-layer",this.sourceId="radius-source",this.map=t,this.strokeLayer=new T(t)}return Object(c.a)(e,[{key:"update",value:function(e,t){e>0?(this.addSource(e,t),this.addLayer(),this.strokeLayer.update(e,t)):this.remove()}},{key:"addSource",value:function(e,t){var n=this.getSource(),a=function(e,t){return B.circle(e.toArray(),t)}(t,e);n?n.setData(a):this.map.addSource(this.sourceId,{type:"geojson",data:a})}},{key:"addLayer",value:function(){this.gerLayer()||this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",paint:{"fill-color":"#292828","fill-opacity":.4}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}();function F(){return H.apply(this,arguments)}function H(){return(H=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),100)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J=function(){function e(){Object(u.a)(this,e)}return Object(c.a)(e,[{key:"sendInfoAboutIncludedZones",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:console.log(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),V=function(e){var t=e.zones,n=e.itHasPoint;return o.a.createElement("div",{className:"map-table"},n?t.length?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:I},"You have selected the following zones:"),o.a.createElement("div",{className:S},t.map((function(e){return o.a.createElement("span",{key:e.id},e.name)})))):o.a.createElement("span",{className:I},"No zones in the radius"):o.a.createElement("span",{className:I},"Set point on the map"))},G=function(){function e(t){var n=this;Object(u.a)(this,e),this.data={lngLat:null,radius:1,zones:[]},this.itHasPoint=!1,this.onButtonClick=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.userApi.sendInfoAboutIncludedZones(n.data);case 2:case"end":return e.stop()}}),e)}))),this.onRadiusChanged=function(e){var t=e.radius;n.data.radius=t,n.updateRadiusLayer(),n.findZonesInRadius()},this.onDragEndMarker=function(e){var t=e.lngLat;n.data.lngLat=t,n.updateRadiusLayer(),n.findZonesInRadius()},this.onMapClick=function(e){n.markerLayer.update(e.lngLat),n.data.lngLat=e.lngLat,n.itHasPoint=!0,n.findZonesInRadius(),n.updateRadiusLayer(),n.updateUserTable()},this.zoneControll=t,this.userApi=new J}return Object(c.a)(e,[{key:"onAdd",value:function(e){this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",this.table=document.createElement("div");var t=document.getElementById(y);return t&&t.appendChild(this.table),this.enableUserMode(),this.container}},{key:"onRemove",value:function(){this.disableUserMode(),this.table.parentNode.removeChild(this.table),this.container.parentNode.removeChild(this.container),this.data={lngLat:null,radius:1,zones:[]},this.itHasPoint=!1,this.map=void 0}},{key:"disableUserMode",value:function(){this.markerLayer&&this.markerLayer.remove(),this.radiusLayer&&this.radiusLayer.remove(),this.map.off("click",this.onMapClick),this.removeUserTable()}},{key:"enableUserMode",value:function(){this.markerLayer=new D(this.map),this.radiusLayer=new U(this.map),this.markerLayer.on(O,this.onDragEndMarker),this.markerLayer.on(P,this.onRadiusChanged),this.markerLayer.on(j,this.onButtonClick),this.map.once("click",this.onMapClick),this.updateUserTable()}},{key:"updateUserTable",value:function(){i.a.render(o.a.createElement(V,{itHasPoint:this.itHasPoint,zones:this.data.zones}),this.table)}},{key:"removeUserTable",value:function(){i.a.unmountComponentAtNode(this.table)}},{key:"findZonesInRadius",value:function(){var e=this;if(!this.data.lngLat||!this.data.radius)return this.data.zones=[],void this.updateUserTable();var t=this.zoneControll.getZoneList().filter((function(t){return function(e,t,n){if(!(n.length<2)){var a=B.lineString(n),o=B.point(t.toArray());return B.pointToLineDistance(o,a)<=e}}(e.data.radius,e.data.lngLat,t.coordinates)}));this.data.zones=t.map((function(e){return{name:e.name,id:e.id}})),this.updateUserTable()}},{key:"updateRadiusLayer",value:function(){this.data.lngLat&&this.radiusLayer.update(this.data.radius,this.data.lngLat)}}]),e}(),Y=n(12),W=n.n(Y),q=function(){function e(t,n,a){Object(u.a)(this,e);var o=a&&a.color||"#008888";this.map=t,this.layerId="zone-stroke-layer-".concat(n),this.sourceId="zone-stroke-source-".concat(n),this.id=n,this.color=o}return Object(c.a)(e,[{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"setColor",value:function(e){this.color=e,this.map.setPaintProperty(this.layerId,"line-color",e)}},{key:"addSource",value:function(e){var t=function(e,t){var n=R(e,t);if(n&&!(n.geometry.coordinates.length<4)){var a=B.lineToPolygon(n);return B.polygonToLine(a)}}(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":this.color,"line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),Q=function(){function e(t,n,a){Object(u.a)(this,e),this.name=a&&a.name?a.name:" ",this.map=t,this.layerId="zone-name-layer-".concat(n),this.sourceId="zone-name-source-".concat(n),this.id=n}return Object(c.a)(e,[{key:"updateName",value:function(e){this.name=e,this.map.setLayoutProperty(this.layerId,"text-field",e)}},{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"addSource",value:function(e){var t=A(e);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,minzoom:12,type:"symbol",layout:{"text-field":this.name,"text-size":["interpolate",["exponential",1.5],["zoom"],12,12,18,46]},paint:{"text-color":"white"}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),X=function(){function e(t,n,a){Object(u.a)(this,e),this.map=t,this.layerId="zone-layer-".concat(n),this.sourceId="zone-source-".concat(n),this.id=n,this.color=a&&a.color||"#008888",this.strokeLayer=new q(t,n,a),this.nameLayer=new Q(t,n,a)}return Object(c.a)(e,[{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addSource(e),this.addLayer(),this.strokeLayer.update(e),t||this.nameLayer.update(e)}},{key:"updateName",value:function(e){this.nameLayer.updateName(e)}},{key:"setColor",value:function(e){this.color=e,this.map.setPaintProperty(this.layerId,"fill-color",e),this.strokeLayer.setColor(e)}},{key:"addSource",value:function(e){var t=function(e,t){var n=R(e,t);if(n&&!(n.geometry.coordinates.length<4)){var a=B.lineToPolygon(n);return B.kinks(a).features.length&&(a=B.unkinkPolygon(a)),a}}(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",layout:{},paint:{"fill-color":this.color,"fill-opacity":.5,"fill-outline-color":"transparent"}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer.remove(),this.nameLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}();function $(e){e&&(e.dragPan.enable(),e.boxZoom.enable(),e.scrollZoom.enable(),e.dragRotate.enable(),e.doubleClickZoom.enable(),e.touchZoomRotate.enable(),e.touchPitch.enable())}function K(e){e&&(e.dragPan.disable(),e.boxZoom.disable(),e.scrollZoom.disable(),e.dragRotate.disable(),e.doubleClickZoom.disable(),e.touchZoomRotate.disable(),e.touchPitch.disable())}function ee(e){e&&(e.getCanvas().style.cursor="default")}function te(e){e&&(e.getCanvas().style.cursor="")}function ne(e,t){var n=document.createElement("button");return n.className=k,n.innerHTML=e,n.addEventListener("click",t),n}function ae(e){e.classList.contains(g)&&e.classList.remove(g)}function oe(e){e.classList.contains(g)||e.classList.add(g)}var re=n(15),ie=function(){function e(){Object(u.a)(this,e),this.localStoragekey="mapZones"}return Object(c.a)(e,[{key:"getZoneList",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:if(t=localStorage.getItem(this.localStoragekey)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",JSON.parse(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n,a,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:return n=[],e.next=5,this.getZoneList();case 5:(a=e.sent)&&(n=Object(re.a)(a)),n.push(t),o=JSON.stringify(n),localStorage.setItem(this.localStoragekey,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n,a,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:return e.next=4,this.getZoneList();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:a=n.map((function(e){return e.id===t.id?t:e})),o=JSON.stringify(a),localStorage.setItem(this.localStoragekey,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n,a,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:return e.next=4,this.getZoneList();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:a=n.filter((function(e){return e.id!==t})),o=JSON.stringify(a),localStorage.setItem(this.localStoragekey,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),se=function(e){var t=e.name,n=e.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{htmlFor:"popup-input-name",className:L},"Enter zone name:"),o.a.createElement("br",null),o.a.createElement("input",{type:"text",id:"popup-input-name",defaultValue:t||" ",className:b,onChange:n}),o.a.createElement("br",null))},ue=function(e){var t=e.color,n=e.onChange;return o.a.createElement("div",{className:w},o.a.createElement("label",{htmlFor:"popup-input-color",className:L},"Select zone color:"),o.a.createElement("input",{type:"color",id:"popup-input-color",defaultValue:t||"#008888",onChange:n}))},ce=function(e){var t=e.name,n=e.onChangeName,a=e.color,r=e.onChangeColor,i=e.onClickEdit,s=e.onClickSave,u=e.onClickCancel;return o.a.createElement(z,null,o.a.createElement(se,{name:t,onChange:n}),o.a.createElement(ue,{color:a,onChange:r}),o.a.createElement(x,{text:"Edit Geometry",onClick:i}),o.a.createElement("div",{className:E},o.a.createElement(x,{text:"Cancel",onClick:u}),o.a.createElement(x,{text:"Save",onClick:s})))},le=function(e){var t=e.name,n=e.color,a=e.onChangeName,r=e.onChangeColor,i=e.onClickCancel,s=e.onClickSave;return o.a.createElement(z,null,o.a.createElement(se,{name:t,onChange:a}),o.a.createElement(ue,{color:n,onChange:r}),o.a.createElement("div",{className:E},o.a.createElement(x,{text:"Cancel",onClick:i}),o.a.createElement(x,{text:"Save",onClick:s})))},de=function(e){var t=e.title;return o.a.createElement("span",{className:Z},t||" ")},he=function(e){var t=e.name,n=e.onClickDelete,a=e.onClickCancel;return o.a.createElement(z,null,o.a.createElement(de,{title:"Do you want to delete a zone ".concat(t,"?")}),o.a.createElement("div",{className:E},o.a.createElement(x,{text:"Cancel",onClick:a}),o.a.createElement(x,{text:"Delete",onClick:n})))},pe=function(){function e(t,n,a){Object(u.a)(this,e);var o=a&&a.color||"#008888";this.map=t,this.layerId="zone-stroke-layer-".concat(n),this.sourceId="zone-stroke-source-".concat(n),this.id=n,this.color=o}return Object(c.a)(e,[{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"addSource",value:function(e){var t=R(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":this.color,"line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),me=function(){function e(t){var n=this;Object(u.a)(this,e),this.isCreateMode=!1,this.isEditMode=!1,this.isDeleteMode=!1,this.deleteZoneId=null,this.editZoneId=null,this.cacheZone=null,this.newZone={name:"",color:"#008888",id:null,coordinates:[]},this.zoneLayerPatternId=/zone-layer-\w/i,this.onClickEditButton=function(){if(n.isEditMode)return n.disableEditMode();n.disableAllModes(),n.enableEditMode()},this.onMouseUpEdit=function(e){n.map&&n.map.off("mousemove",n.onMouseMoveEdit),n.editZone&&n.showEditPopup(n.editZone.id),n.drawEditLayer.remove(),n.editZone&&n.editZone.coordinates.length>4&&n.zoneControll.updateZoneCoordinates(n.editZone.id,n.editZone.coordinates),$(n.map),te(n.map),n.addCursorPointerListener()},this.onMouseMoveEdit=function(e){n.editZone&&(n.editZone.coordinates.push(e.lngLat.toArray()),n.updateEditZoneLayer())},this.onMouseDownEdit=function(e){n.map&&n.map.on("mousemove",n.onMouseMoveEdit),n.map&&n.map.once("mouseup",n.onMouseUpEdit)},this.onGeometryEdit=function(){n.editPopup&&n.editPopup.remove(),K(n.map),n.removeCursorPointerListener(),ee(n.map),n.drawEditLayer=new pe(n.map,n.editZone.id,{color:n.editZone.color}),n.zoneControll.removeZoneLayer(n.editZone.id),n.editZone.coordinates=[],n.map&&n.map.on("mousedown",n.onMouseDownEdit)},this.cancelEditZone=function(){n.zoneControll.drawZones(),n.editPopup&&n.editPopup.remove(),n.editZone=null},this.onSaveEdit=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneControll.updateZone(n.editZone);case 2:n.editPopup&&n.editPopup.remove(),n.editZone=null;case 4:case"end":return e.stop()}}),e)}))),this.editZoneColor=function(e){var t=e.target.value;n.editZone.color=t,n.zoneControll.updateZoneColor(n.editZone.id,t)},this.editZoneName=function(e){n.editZone.name=e.target.value},this.onClickEdit=function(e){var t=n.getZoneFeatureByEvent(e);if(t){var a=t.properties.id;if(!n.editZone||a!==n.editZone.id){n.editPopup&&n.editPopup.remove();var o=n.zoneControll.getZoneById(a);n.editZone=W.a.cloneDeep(o),n.showEditPopup()}}},this.enableEditMode=function(){oe(n.editButton),n.addCursorPointerListener(),n.map&&n.map.on("click",n.onClickEdit),n.isEditMode=!0},this.disableEditMode=function(){ae(n.editButton),n.removeCursorPointerListener(),n.map&&n.map.off("click",n.onClickEdit),n.cancelEditZone(),n.editZone=null,n.isEditMode=!1},this.onClickCreateButton=function(){if(n.isCreateMode)return n.disableCreateMode();n.disableAllModes(),n.enableCreateMode()},this.disableCreateMode=function(){n.newZone={name:"",color:"#008888",id:null,coordinates:[]},n.createPopup&&n.createPopup.remove(),n.newZonelayer&&n.newZonelayer.remove(),n.drawlayer&&n.drawlayer.remove(),ae(n.createButton),$(n.map),te(n.map),n.isCreateMode=!1},this.setNewZoneName=function(e){n.newZone.name=e.target.value},this.setNewZoneColor=function(e){n.newZone.color=e.target.value,n.updateColorInNewZone()},this.createZone=function(){var e=W.a.cloneDeep(n.newZone);n.zoneControll.createZone(e),n.onClickCreateButton(),n.createPopup.remove(),n.newZonelayer.remove(),n.drawlayer.remove(),n.newZone={name:"",color:"#008888",id:null,coordinates:[]}},this.onMouseUpCreate=function(e){n.map.off("mousemove",n.onMouseMoveCreate),n.showCreatePopup(),n.drawlayer&&n.drawlayer.remove(),n.newZonelayer&&n.newZonelayer.update(n.newZone.coordinates,!0)},this.onMouseMoveCreate=function(e){n.newZone.coordinates.push(e.lngLat.toArray()),n.updateNewZoneLayer()},this.onMouseDownCreate=function(e){n.newZone.coordinates.push(e.lngLat.toArray()),n.map&&n.map.on("mousemove",n.onMouseMoveCreate),n.map&&n.map.once("mouseup",n.onMouseUpCreate)},this.cancelDeleteZone=function(){n.deletePopup.remove(),n.deleteZoneId=null},this.deleteZone=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneControll.deleteZone(n.deleteZoneId);case 2:n.deletePopup.remove(),n.deleteZoneId=null;case 4:case"end":return e.stop()}}),e)}))),this.onClickDeleteZone=function(e){var t=n.getZoneFeatureByEvent(e);if(t){var a=t.properties.id;a!==n.deleteZoneId&&(n.deletePopup&&n.deletePopup.remove(),n.showDeletePopup(a),n.deleteZoneId=a)}},this.onClickDeleteButton=function(){if(n.isDeleteMode)return n.disableDeleteMode();n.disableAllModes(),n.enableDeletetingMode()},this.cursorListener=function(e){var t=n.getZoneFeatureByEvent(e);n.map.getCanvas().style.cursor=t?"pointer":""},this.zoneControll=t,this.zoneApi=new ie}return Object(c.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group",this.createButton=ne('\n\t<svg version="1.1" viewBox="0 0 42 42">\n\t\t<path d="M37.059,16H26V4.941C26,2.224,23.718,0,21,0s-5,2.224-5,4.941V16H4.941C2.224,16,0,18.282,0,21s2.224,5,4.941,5H16v11.059\n\t\tC16,39.776,18.282,42,21,42s5-2.224,5-4.941V26h11.059C39.776,26,42,23.718,42,21S39.776,16,37.059,16z" />\n\t</svg>\n\t',this.onClickCreateButton),this.deleteButton=ne('\n\t<svg version="1.1" viewBox="0 0 384 384">\n\t\t<path\n\t\td="M64,341.333C64,364.907,83.093,384,106.667,384h170.667C300.907,384,320,364.907,320,341.333v-256H64V341.333z" />\n\t\t<polygon\n\t\tpoints="266.667,21.333 245.333,0 138.667,0 117.333,21.333 42.667,21.333 42.667,64 341.333,64 341.333,21.333 \t\t\t" />\n\t</svg>\n\t',this.onClickDeleteButton),this.editButton=ne('\n\t<svg version="1.1" viewBox="0 0 383.947 383.947">\n\t\t<polygon points="0,303.947 0,383.947 80,383.947 316.053,147.893 236.053,67.893" />\n\t\t<path\n\t\td="M377.707,56.053L327.893,6.24c-8.32-8.32-21.867-8.32-30.187,0l-39.04,39.04l80,80l39.04-39.04C386.027,77.92,386.027,64.373,377.707,56.053z" />\n\t</svg>\n\t',this.onClickEditButton),this.container.appendChild(this.createButton),this.container.appendChild(this.deleteButton),this.container.appendChild(this.editButton),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.disableAllModes(),this.map=void 0}},{key:"updateEditZoneLayer",value:function(){!this.editZone||this.editZone.coordinates.length<4||this.drawEditLayer.update(this.editZone.coordinates)}},{key:"showEditPopup",value:function(){var e=_(this.editZone.coordinates);if(e){var t=document.createElement("div");this.editPopup=new p.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(e).setDOMContent(t).addTo(this.map),i.a.render(o.a.createElement(ce,{color:this.editZone.color,name:this.editZone.name,onChangeName:this.editZoneName,onChangeColor:this.editZoneColor,onClickCancel:this.cancelEditZone,onClickSave:this.onSaveEdit,onClickEdit:this.onGeometryEdit}),t)}}},{key:"enableCreateMode",value:function(){this.newZone={name:"",color:"#008888",id:null,coordinates:[]};var e=Date.now().toString(36)+Math.random().toString(36).substr(2);this.newZone.id=e,this.map&&(this.drawlayer=new pe(this.map,e)),this.newZonelayer=new X(this.map,e),this.map&&this.map.once("mousedown",this.onMouseDownCreate),oe(this.createButton),K(this.map),ee(this.map),this.isCreateMode=!0}},{key:"updateColorInNewZone",value:function(){this.newZonelayer.setColor(this.newZone.color)}},{key:"showCreatePopup",value:function(){var e=_(this.newZone.coordinates);if(e){var t=document.createElement("div");this.createPopup=new p.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(e).setDOMContent(t).addTo(this.map);var n=this.zoneControll.getNewZoneName();this.newZone.name=n,i.a.render(o.a.createElement(le,{name:n,color:null,onChangeName:this.setNewZoneName,onChangeColor:this.setNewZoneColor,onClickCancel:this.disableCreateMode,onClickSave:this.createZone}),t)}}},{key:"updateNewZoneLayer",value:function(){this.newZone.coordinates.length<4||this.drawlayer.update(this.newZone.coordinates,!0)}},{key:"showDeletePopup",value:function(e){var t=this.zoneControll.getZoneById(e);if(t){var n=_(t.coordinates);if(n){var a=document.createElement("div");this.deletePopup=new p.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(n).setDOMContent(a).addTo(this.map),i.a.render(o.a.createElement(he,{name:t.name,onClickCancel:this.cancelDeleteZone,onClickDelete:this.deleteZone}),a)}}}},{key:"enableDeletetingMode",value:function(){this.map&&this.map.on("click",this.onClickDeleteZone),oe(this.deleteButton),this.addCursorPointerListener(),this.isDeleteMode=!0}},{key:"disableDeleteMode",value:function(){this.map&&this.map.off("click",this.onClickDeleteZone),ae(this.deleteButton),this.deletePopup&&(this.deletePopup.remove(),this.deletePopup=null),this.removeCursorPointerListener(),this.isDeleteMode=!1,this.deleteZoneId=null}},{key:"addCursorPointerListener",value:function(){this.map.on("mousemove",this.cursorListener)}},{key:"removeCursorPointerListener",value:function(){this.map.off("mousemove",this.cursorListener)}},{key:"disableAllModes",value:function(){this.isEditMode&&this.disableEditMode(),this.isDeleteMode&&this.disableDeleteMode(),this.isCreateMode&&this.disableCreateMode()}},{key:"getZoneFeatureByEvent",value:function(e){var t=this.map.queryRenderedFeatures(e.point);if(t.length){var n=t.shift();if(n)return n.layer.id.match(this.zoneLayerPatternId)?n:void 0}}}]),e}(),ve=(n(24),n(25),function(){function e(){var t=this;Object(u.a)(this,e),this.zones=[],this.zoneApi=new ie,this.layers=new Map,this.init=Object(f.a)(v.a.mark((function e(){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.zoneApi.getZoneList();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.zones=n,t.drawZones();case 7:case"end":return e.stop()}}),e)})))}return Object(c.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",e.on("load",this.init),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.map=void 0}},{key:"deleteZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.deleteZone(t);case 2:if(this.zones=this.zones.filter((function(e){return e.id!==t})),n=this.layers.get(t)){e.next=6;break}return e.abrupt("return");case 6:n.remove(),this.layers.delete(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.updateZone(t);case 2:this.zones=this.zones.map((function(e){return e.id===t.id?t:e})),this.drawZones();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.addZone(t);case 2:this.zones.push(t),this.drawZones();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getZoneList",value:function(){return this.zones}},{key:"getZoneById",value:function(e){return this.zones.find((function(t){return t.id===e}))}},{key:"updateZoneColor",value:function(e,t){var n=this.layers.get(e);n&&n.setColor(t)}},{key:"updateZoneCoordinates",value:function(e,t){var n=this.layers.get(e);n&&n.update(t,!0)}},{key:"removeZoneLayer",value:function(e){var t=this.layers.get(e);t&&t.remove()}},{key:"getNewZoneName",value:function(){return"Zone ".concat(this.zones.length+1)}},{key:"drawZones",value:function(){var e=this;this.zones.forEach((function(t){var n=e.layers.get(t.id);if(n)n.update(t.coordinates),n.setColor(t.color),n.updateName(t.name);else{var a=new X(e.map,t.id,{color:t.color,name:t.name});a.update(t.coordinates),e.layers.set(t.id,a)}}))}}]),e}()),fe={Bengaluru:new p.a.LngLat(77.59094323372614,12.975557791300176)},ye=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.mapStyle,n=e.mapToken,a=e.isAdmin,o=e.cityCoor;p.a.accessToken=n;var r=t||"mapbox://styles/mapbox/streets-v11";this.map=new p.a.Map({container:y,style:r,center:o,zoom:12}),this.zoneControll=new ve,this.map.addControl(this.zoneControll),this.userControll=new G(this.zoneControll),this.adminControll=new me(this.zoneControll),a?this.map.addControl(this.adminControll):this.map.addControl(this.userControll)}},{key:"componentDidUpdate",value:function(e){var t=this.props.isAdmin;if(t!==e.isAdmin){if(!this.map)return;t?(this.map.removeControl(this.userControll),this.map.addControl(this.adminControll)):(this.map.removeControl(this.adminControll),this.map.addControl(this.userControll))}}},{key:"render",value:function(){return o.a.createElement("div",{id:y})}}]),n}(o.a.Component),ke=(n(26),function(){var e=Object(a.useState)(!0),t=Object(s.a)(e,2),n=t[0],r=t[1];return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"test-panel"},o.a.createElement("button",{onClick:function(){return r(!0)},className:n?"test-panel__button-active":""},"ADMIN MODE"),o.a.createElement("button",{onClick:function(){return r(!1)},className:n?"":"test-panel__button-active"},"USER MODE")),o.a.createElement(ye,{mapToken:"pk.eyJ1IjoicG9zdGFtZW50b3ZpY2giLCJhIjoiY2p5bjl1M2IyMHBmYjNkbm81YmdpNmxvdSJ9.IiDCsFdJXwFRW2TBlLqh6A",cityCoor:fe.Bengaluru,isAdmin:n}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(ke,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.716d3a1c.chunk.js.map