(this["webpackJsonpmap-with-zones"]=this["webpackJsonpmap-with-zones"]||[]).push([[0],{26:function(e,t,n){e.exports=n(54)},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(8),i=n.n(r),s=n(9),c=n(2),u=n(3),l=n(15),d=n(13),h=n(11),p=n.n(h),m=n(6),v=n.n(m),y=n(1),f=n.n(y),g=n(4),k="time",C="distance",b=k,L="mapbox-container-element-id",Z="".concat("map-controll","__button"),w="".concat(Z,"_active"),E="".concat("map-popup","__button"),I="".concat("map-popup","__input"),S="".concat("map-popup","__label"),M="".concat("map-popup","__title"),O="".concat("map-popup","__color"),j="".concat("map-popup","__radius-mode"),x="".concat("map-popup","__controls"),z="".concat("map-table","__title"),N="".concat("map-table","__zones"),P=function(e){var t=e.radius,n=e.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{htmlFor:"popup-input-radius",className:S},"Enter radius (km):"),o.a.createElement("br",null),o.a.createElement("input",{type:"number",id:"popup-input-radius",defaultValue:t||0,className:I,onChange:n}),o.a.createElement("br",null))},D=function(e){var t=e.children;return o.a.createElement("div",{className:"map-popup"},t)},B=function(e){var t=e.text,n=e.onClick;return o.a.createElement("button",{className:E,onClick:n,type:"button"},t||" ")},A=function(e){var t=e.mode,n=e.onChangeMode;return o.a.createElement("div",{className:j},o.a.createElement("label",{htmlFor:"radius-mode-time"},"Time"),o.a.createElement("input",{type:"radio",id:"radius-mode-time",value:k,name:"radius-mode",checked:t===k,onChange:n}),o.a.createElement("label",{htmlFor:"radius-mode-distance"},"Distance"),o.a.createElement("input",{type:"radio",id:"radius-mode-distance",value:C,name:"radius-mode",checked:t===C,onChange:n}))},T=function(e){var t=e.time,n=e.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{htmlFor:"popup-input-time",className:S},"Enter time (min):"),o.a.createElement("br",null),o.a.createElement("input",{type:"number",id:"popup-input-time",defaultValue:t||0,className:I,onChange:n,max:60}),o.a.createElement("br",null))},_=function(e){var t=e.radius,n=e.onChangeRadius,r=e.onClickSelect,i=e.onChangeMode,c=e.time,u=e.onChangeTime,l=e.mode,d=Object(a.useState)(l),h=Object(s.a)(d,2),p=h[0],m=h[1],v=Object(a.useCallback)((function(e){m(e.target.value),i(e)}),[i]),y=Object(a.useState)(t),f=Object(s.a)(y,2),g=f[0],b=f[1],L=Object(a.useCallback)((function(e){b(e.target.value),n(e)}),[n]),Z=Object(a.useState)(c),w=Object(s.a)(Z,2),E=w[0],I=w[1],S=Object(a.useCallback)((function(e){I(e.target.value),u(e)}),[u]);return o.a.createElement(D,null,o.a.createElement(A,{mode:p,onChangeMode:v}),p===k&&o.a.createElement(T,{time:E,onChange:S}),p===C&&o.a.createElement(P,{radius:g,onChange:L}),o.a.createElement("div",{className:x},o.a.createElement(B,{text:"Select",onClick:r})))},R="dragend",F="radiusChanged",H="buttonClick",U="modeChanged",J="timeChanged",V=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this)).radiusInputId="marker-input-radius",a.radiusButtonId="marker-button-radius",a.onChangeMode=function(e){a.fire(U,{mode:e.target.value})},a.onTimeChange=function(e){a.fire(J,{time:Number(e.target.value)})},a.onRadiusChange=function(e){a.fire(F,{radius:Number(e.target.value)})},a.onDragEnd=function(){var e=a.marker.getLngLat();a.fire(R,{lngLat:e})},a.onButtonClick=function(){a.fire(H)},a.map=e,a.marker=new v.a.Marker({draggable:!0}),a.popupContainer=document.createElement("div"),a.popup=new v.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setDOMContent(a.popupContainer),a}return Object(u.a)(n,[{key:"remove",value:function(){this.marker&&this.marker.remove(),this.popup&&this.popup.remove()}},{key:"init",value:function(e,t){this.marker.setLngLat(e.toArray()),this.marker.setPopup(this.popup),this.marker.addTo(this.map),this.marker.togglePopup(),this.marker.on("dragend",this.onDragEnd),i.a.render(o.a.createElement(_,{radius:t.radius,time:t.time,mode:t.mode,onChangeRadius:this.onRadiusChange,onClickSelect:this.onButtonClick,onChangeMode:this.onChangeMode,onChangeTime:this.onTimeChange}),this.popupContainer)}}]),n}(v.a.Evented),G=n(5);function W(){return{lngLat:null,radius:1,time:10,mode:b,zones:[]}}function Y(e){var t=Q(e);if(t)return G.center(t)}function q(e){var t=Y(e);if(t)return G.getCoord(t)}function Q(e,t){if(!(e.length<2)){var n=G.lineString(e,{id:t});return G.cleanCoords(G.simplify(n,{tolerance:1e-5,highQuality:!0}))}}function X(e){e&&(e.dragPan.enable(),e.boxZoom.enable(),e.scrollZoom.enable(),e.dragRotate.enable(),e.doubleClickZoom.enable(),e.touchZoomRotate.enable(),e.touchPitch.enable())}function $(e){e&&(e.dragPan.disable(),e.boxZoom.disable(),e.scrollZoom.disable(),e.dragRotate.disable(),e.doubleClickZoom.disable(),e.touchZoomRotate.disable(),e.touchPitch.disable())}function K(e){e&&(e.getCanvas().style.cursor="default")}function ee(e){e&&(e.getCanvas().style.cursor="")}function te(e){return{"line-color":e,"line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6]}}var ne=function(){function e(t){Object(c.a)(this,e),this.map=t,this.layerId="radius-stroke-layer",this.sourceId="radius-stroke-source"}return Object(u.a)(e,[{key:"update",value:function(e,t){this.addSource(e,t),this.addLayer()}},{key:"addSource",value:function(e,t){var n=function(e,t){if(e&&t){var n=G.circle(e.toArray(),t);return G.polygonToLine(n)}}(t,e);if(n){var a=this.getSource();if(a)return a.setData(n);this.map.addSource(this.sourceId,{type:"geojson",data:n})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#292828","line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6],"line-dasharray":[5,3]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),ae=function(){function e(t){Object(c.a)(this,e),this.layerId="radius-layer",this.sourceId="radius-source",this.map=t,this.strokeLayer=new ne(t)}return Object(u.a)(e,[{key:"update",value:function(e,t){e>0?(this.addSource(e,t),this.addLayer(),this.strokeLayer.update(e,t)):this.remove()}},{key:"addSource",value:function(e,t){var n=this.getSource(),a=function(e,t){return G.circle(e.toArray(),t)}(t,e);n?n.setData(a):this.map.addSource(this.sourceId,{type:"geojson",data:a})}},{key:"addLayer",value:function(){this.gerLayer()||this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",paint:{"fill-color":"#292828","fill-opacity":.3}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}();function oe(){return re.apply(this,arguments)}function re(){return(re=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),100)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"sendInfoAboutIncludedZones",value:function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:console.log(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),se=function(e){var t=e.zones,n=e.itHasPoint;return o.a.createElement("div",{className:"map-table"},n?t.length?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:z},"You have selected the following zones:"),o.a.createElement("div",{className:N},t.map((function(e){return o.a.createElement("span",{key:e.id},e.name)})))):o.a.createElement("span",{className:z},"No zones in the radius"):o.a.createElement("span",{className:z},"Set point on the map"))},ce=n(16),ue=n.n(ce),le=ue.a.CancelToken,de=null,he=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"cancelIsochroneFetch",value:function(){de&&de()}},{key:"getIsochrone",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a,o,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cancelIsochroneFetch(),a="https://api.mapbox.com/isochrone/v1/mapbox/driving/".concat(t.lng,",").concat(t.lat,"?contours_minutes=").concat(n,"&polygons=true&access_token=").concat(v.a.accessToken),e.prev=2,e.next=5,ue.a.get(a,{cancelToken:new le((function(e){de=e}))});case 5:return o=e.sent,r=o.data,e.abrupt("return",r);case 10:throw e.prev=10,e.t0=e.catch(2),console.error(e.t0),e.t0;case 14:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),pe=function(){function e(t){Object(c.a)(this,e),this.map=t,this.layerId="isochrone-stroke-layer",this.sourceId="isochrone-stroke-source"}return Object(u.a)(e,[{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"addSource",value:function(e){if(e){var t=function(e){var t=G.coordAll(e);return G.lineString(t)}(e),n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#292828","line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6],"line-dasharray":[5,3]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),me=function(){function e(t){Object(c.a)(this,e),this.layerId="isochrone-layer",this.sourceId="isochrone-source",this.map=t,this.strokeLayer=new pe(t),this.mapboxApi=new he}return Object(u.a)(e,[{key:"update",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>0)){e.next=7;break}return e.next=3,this.addSource(t,n);case 3:this.addLayer(),this.strokeLayer.update(this.data),e.next=8;break;case 7:this.remove();case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addSource",value:function(){var e=Object(g.a)(f.a.mark((function e(t,n){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getSource(),e.prev=1,e.next=4,this.mapboxApi.getIsochrone(n,t);case 4:this.data=e.sent,a?a.setData(this.data):this.map.addSource(this.sourceId,{type:"geojson",data:this.data}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFeatureCollection",value:function(){return this.data}},{key:"addLayer",value:function(){this.gerLayer()||this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",paint:{"fill-color":"#292828","fill-opacity":.3}})}},{key:"remove",value:function(){this.mapboxApi.cancelIsochroneFetch(),this.data=null,this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer&&this.strokeLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),ve=function(){function e(t){var n=this;Object(c.a)(this,e),this.data=W(),this.radiusMode=k,this.itHasPoint=!1,this.onTimeChanged=function(e){var t=e.time;n.data.time=t,n.updateRadiusLayer()},this.onModeChanged=function(e){var t=e.mode;n.data.mode=t,n.updateRadiusLayer()},this.onButtonClick=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.userApi.sendInfoAboutIncludedZones(n.data);case 2:case"end":return e.stop()}}),e)}))),this.onRadiusChanged=function(e){var t=e.radius;n.data.radius=t,n.updateRadiusLayer()},this.onDragEndMarker=function(e){var t=e.lngLat;n.data.lngLat=t,n.updateRadiusLayer()},this.onMapClick=function(e){n.markerLayer.init(e.lngLat,n.data),n.data.lngLat=e.lngLat,n.itHasPoint=!0,n.updateRadiusLayer(),n.updateUserTable()},this.zoneControll=t,this.userApi=new ie}return Object(u.a)(e,[{key:"onAdd",value:function(e){this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",this.table=document.createElement("div");var t=document.getElementById(L);return t&&t.appendChild(this.table),this.enableUserMode(),this.container}},{key:"onRemove",value:function(){this.disableUserMode(),this.table&&this.table.parentNode.removeChild(this.table),this.container&&this.container.parentNode.removeChild(this.container),this.data=W(),this.itHasPoint=!1,this.map=void 0}},{key:"disableUserMode",value:function(){this.markerLayer&&this.markerLayer.remove(),this.radiusLayer&&this.radiusLayer.remove(),this.isochroneLayer&&this.isochroneLayer.remove(),this.map&&this.map.off("click",this.onMapClick),this.removeUserTable()}},{key:"updateUserTable",value:function(){i.a.render(o.a.createElement(se,{itHasPoint:this.itHasPoint,zones:this.data.zones}),this.table)}},{key:"removeUserTable",value:function(){this.table&&i.a.unmountComponentAtNode(this.table)}},{key:"enableUserMode",value:function(){this.markerLayer=new V(this.map),this.radiusLayer=new ae(this.map),this.isochroneLayer=new me(this.map),this.markerLayer.on(R,this.onDragEndMarker),this.markerLayer.on(F,this.onRadiusChanged),this.markerLayer.on(H,this.onButtonClick),this.markerLayer.on(U,this.onModeChanged),this.markerLayer.on(J,this.onTimeChanged),this.map.once("click",this.onMapClick),this.updateUserTable()}},{key:"findZonesInRadius",value:function(){var e=this,t=this.data.mode===k,n=this.data.mode===C,a=n&&this.data.radius>0,o=t&&this.data.time>0;if(!this.data.lngLat||!a&&!o)return this.data.zones=[],void this.updateUserTable();var r=this.zoneControll.getZoneList(),i=this.isochroneLayer.getFeatureCollection(),s=r.filter((function(t){return n?function(e,t,n){if(!(n.length<2)){var a=G.lineString(n),o=G.point(t.toArray());return G.pointToLineDistance(o,a)<=e}}(e.data.radius,e.data.lngLat,t.coordinates):function(e,t,n){if(e&&t){var a=G.lineString(t),o=e.features[0],r=G.point(n.toArray()),i=G.nearestPointOnLine(a,r),s=G.pointsWithinPolygon(i,o);return!!(s&&s.features.length)}}(i,t.coordinates,e.data.lngLat)}));this.data.zones=s.map((function(e){return{name:e.name,id:e.id}})),this.updateUserTable()}},{key:"updateRadiusLayer",value:function(){var e=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.data.lngLat){e.next=2;break}return e.abrupt("return");case 2:if(this.data.mode!==k){e.next=8;break}return this.radiusLayer&&this.radiusLayer.remove(),e.next=6,this.isochroneLayer.update(this.data.time,this.data.lngLat);case 6:e.next=10;break;case 8:this.isochroneLayer&&this.isochroneLayer.remove(),this.radiusLayer.update(this.data.radius,this.data.lngLat);case 10:this.findZonesInRadius();case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ye=function(){function e(t,n,a){Object(c.a)(this,e);var o=a&&a.color||"#008888";this.map=t,this.layerId="zone-stroke-layer-".concat(n),this.sourceId="zone-stroke-source-".concat(n),this.id=n,this.color=o}return Object(u.a)(e,[{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"setColor",value:function(e){this.color=e,this.map.setPaintProperty(this.layerId,"line-color",e)}},{key:"addSource",value:function(e){var t=function(e,t){var n=Q(e,t);if(n&&!(n.geometry.coordinates.length<4)){var a=G.lineToPolygon(n);return G.polygonToLine(a)}}(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:te(this.color)})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),fe=function(){function e(t,n,a){Object(c.a)(this,e),this.name=a&&a.name?a.name:" ",this.map=t,this.layerId="zone-name-layer-".concat(n),this.sourceId="zone-name-source-".concat(n),this.id=n}return Object(u.a)(e,[{key:"updateName",value:function(e){this.name=e,this.map.setLayoutProperty(this.layerId,"text-field",e)}},{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"addSource",value:function(e){var t=Y(e);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,minzoom:12,type:"symbol",layout:{"text-field":this.name,"text-size":["interpolate",["exponential",1.5],["zoom"],12,12,18,46]},paint:{"text-color":"white"}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),ge=function(){function e(t,n,a){Object(c.a)(this,e),this.map=t,this.layerId="zone-layer-".concat(n),this.sourceId="zone-source-".concat(n),this.id=n,this.color=a&&a.color||"#008888",this.strokeLayer=new ye(t,n,a),this.nameLayer=new fe(t,n,a)}return Object(u.a)(e,[{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addSource(e),this.addLayer(),this.strokeLayer.update(e),t||this.nameLayer.update(e)}},{key:"updateName",value:function(e){this.nameLayer.updateName(e)}},{key:"setColor",value:function(e){this.color=e,this.map.setPaintProperty(this.layerId,"fill-color",e),this.strokeLayer.setColor(e)}},{key:"addHighlight",value:function(){this.map.setPaintProperty(this.layerId,"fill-opacity",.8)}},{key:"removeHighlight",value:function(){this.map.setPaintProperty(this.layerId,"fill-opacity",.3)}},{key:"addSource",value:function(e){var t=function(e,t){var n=Q(e,t);if(n&&!(n.geometry.coordinates.length<4)){var a=G.lineToPolygon(n);return G.kinks(a).features.length&&(a=G.unkinkPolygon(a)),a}}(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){var e;!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",paint:(e=this.color,{"fill-color":e,"fill-opacity":.3,"fill-outline-color":"transparent"})})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer.remove(),this.nameLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}();function ke(e,t){var n=document.createElement("button");return n.className=Z,n.innerHTML=e,n.addEventListener("click",t),n}function Ce(e){e.classList.contains(w)&&e.classList.remove(w)}function be(e){e.classList.contains(w)||e.classList.add(w)}var Le=n(14),Ze=function(){function e(){Object(c.a)(this,e),this.localStoragekey="mapZones"}return Object(u.a)(e,[{key:"getZoneList",value:function(){var e=Object(g.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:if(t=localStorage.getItem(this.localStoragekey)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",JSON.parse(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addZone",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:return n=[],e.next=5,this.getZoneList();case 5:(a=e.sent)&&(n=Object(Le.a)(a)),n.push(t),o=JSON.stringify(n),localStorage.setItem(this.localStoragekey,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateZone",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:return e.next=4,this.getZoneList();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:a=n.map((function(e){return e.id===t.id?t:e})),o=JSON.stringify(a),localStorage.setItem(this.localStoragekey,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteZone",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n,a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:return e.next=4,this.getZoneList();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:a=n.filter((function(e){return e.id!==t})),o=JSON.stringify(a),localStorage.setItem(this.localStoragekey,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),we=function(e){var t=e.name,n=e.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{htmlFor:"popup-input-name",className:S},"Enter zone name:"),o.a.createElement("br",null),o.a.createElement("input",{type:"text",id:"popup-input-name",defaultValue:t||" ",className:I,onChange:n}),o.a.createElement("br",null))},Ee=function(e){var t=e.color,n=e.onChange;return o.a.createElement("div",{className:O},o.a.createElement("label",{htmlFor:"popup-input-color",className:S},"Select zone color:"),o.a.createElement("input",{type:"color",id:"popup-input-color",defaultValue:t||"#008888",onChange:n}))},Ie=function(e){var t=e.name,n=e.onChangeName,a=e.color,r=e.onChangeColor,i=e.onClickEdit,s=e.onClickSave,c=e.onClickCancel;return o.a.createElement(D,null,o.a.createElement(we,{name:t,onChange:n}),o.a.createElement(Ee,{color:a,onChange:r}),o.a.createElement(B,{text:"Edit Geometry",onClick:i}),o.a.createElement("div",{className:x},o.a.createElement(B,{text:"Cancel",onClick:c}),o.a.createElement(B,{text:"Save",onClick:s})))},Se=function(e){var t=e.name,n=e.color,a=e.onChangeName,r=e.onChangeColor,i=e.onClickCancel,s=e.onClickSave;return o.a.createElement(D,null,o.a.createElement(we,{name:t,onChange:a}),o.a.createElement(Ee,{color:n,onChange:r}),o.a.createElement("div",{className:x},o.a.createElement(B,{text:"Cancel",onClick:i}),o.a.createElement(B,{text:"Save",onClick:s})))},Me=function(e){var t=e.title;return o.a.createElement("span",{className:M},t||" ")},Oe=function(e){var t=e.name,n=e.onClickDelete,a=e.onClickCancel;return o.a.createElement(D,null,o.a.createElement(Me,{title:"Do you want to delete a zone ".concat(t,"?")}),o.a.createElement("div",{className:x},o.a.createElement(B,{text:"Cancel",onClick:a}),o.a.createElement(B,{text:"Delete",onClick:n})))},je=function(){function e(t,n,a){Object(c.a)(this,e);var o=a&&a.color||"#008888";this.map=t,this.layerId="zone-stroke-layer-".concat(n),this.sourceId="zone-stroke-source-".concat(n),this.id=n,this.color=o}return Object(u.a)(e,[{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"addSource",value:function(e){var t=Q(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:te(this.color)})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),xe=function(){function e(t){var n=this;Object(c.a)(this,e),this.isCreateMode=!1,this.isEditMode=!1,this.isDeleteMode=!1,this.deleteZoneId=null,this.editZoneId=null,this.cacheZone=null,this.newZone={name:"",color:"#008888",id:null,coordinates:[]},this.zoneLayerPatternId=/zone-layer-\w/i,this.onClickEditButton=function(){if(n.isEditMode)return n.disableEditMode();n.disableAllModes(),n.enableEditMode()},this.enableEditMode=function(){be(n.editButton),n.addCursorPointerListener(),n.map&&n.map.on("click",n.onClickEdit),n.isEditMode=!0},this.disableEditMode=function(){Ce(n.editButton),n.removeCursorPointerListener(),n.map&&n.map.off("click",n.onClickEdit),n.cancelEditZone(),n.editZone=null,n.isEditMode=!1},this.onMouseUpEdit=function(e){n.map&&n.map.off("mousemove",n.onMouseMoveEdit),n.editZone&&n.showEditPopup(n.editZone.id),n.drawEditLayer.remove(),n.editZone&&n.editZone.coordinates.length>4&&n.zoneControll.updateZoneCoordinates(n.editZone.id,n.editZone.coordinates),X(n.map),ee(n.map),n.addCursorPointerListener()},this.onMouseMoveEdit=function(e){n.editZone&&(n.editZone.coordinates.push(e.lngLat.toArray()),n.updateEditZoneLayer())},this.onMouseDownEdit=function(e){n.map&&n.map.on("mousemove",n.onMouseMoveEdit),n.map&&n.map.once("mouseup",n.onMouseUpEdit)},this.onGeometryEdit=function(){n.editPopup&&n.editPopup.remove(),$(n.map),n.removeCursorPointerListener(),K(n.map),n.drawEditLayer=new je(n.map,n.editZone.id,{color:n.editZone.color}),n.zoneControll.removeZoneLayer(n.editZone.id),n.editZone.coordinates=[],n.map&&n.map.once("mousedown",n.onMouseDownEdit)},this.cancelEditZone=function(){n.zoneControll.drawZones(),n.editPopup&&n.editPopup.remove(),n.editZone=null},this.onSaveEdit=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneControll.updateZone(n.editZone);case 2:n.editPopup&&n.editPopup.remove(),n.editZone=null;case 4:case"end":return e.stop()}}),e)}))),this.editZoneColor=function(e){var t=e.target.value;n.editZone.color=t,n.zoneControll.updateZoneColor(n.editZone.id,t)},this.editZoneName=function(e){n.editZone.name=e.target.value},this.onClickEdit=function(e){var t=n.getZoneFeatureByEvent(e);if(t){var a=t.properties.id;if(!n.editZone||a!==n.editZone.id){n.editPopup&&n.editPopup.remove();var o=n.zoneControll.getZoneById(a);n.editZone=p.a.cloneDeep(o),n.showEditPopup()}}},this.onClickCreateButton=function(){if(n.isCreateMode)return n.disableCreateMode();n.disableAllModes(),n.enableCreateMode()},this.disableCreateMode=function(){n.newZone={name:"",color:"#008888",id:null,coordinates:[]},n.createPopup&&n.createPopup.remove(),n.newZonelayer&&n.newZonelayer.remove(),n.drawlayer&&n.drawlayer.remove(),Ce(n.createButton),X(n.map),ee(n.map),n.isCreateMode=!1},this.setNewZoneName=function(e){n.newZone.name=e.target.value},this.setNewZoneColor=function(e){n.newZone.color=e.target.value,n.updateColorInNewZone()},this.createZone=function(){var e=p.a.cloneDeep(n.newZone);n.zoneControll.createZone(e),n.onClickCreateButton(),n.createPopup.remove(),n.newZonelayer.remove(),n.drawlayer.remove(),n.newZone={name:"",color:"#008888",id:null,coordinates:[]}},this.onMouseUpCreate=function(e){n.map.off("mousemove",n.onMouseMoveCreate),n.showCreatePopup(),n.drawlayer&&n.drawlayer.remove(),n.newZonelayer&&n.newZonelayer.update(n.newZone.coordinates,!0)},this.onMouseMoveCreate=function(e){n.newZone.coordinates.push(e.lngLat.toArray()),n.updateNewZoneLayer()},this.onMouseDownCreate=function(e){n.newZone.coordinates.push(e.lngLat.toArray()),n.map&&n.map.on("mousemove",n.onMouseMoveCreate),n.map&&n.map.once("mouseup",n.onMouseUpCreate)},this.onClickDeleteButton=function(){if(n.isDeleteMode)return n.disableDeleteMode();n.disableAllModes(),n.enableDeletetingMode()},this.cancelDeleteZone=function(){n.deletePopup.remove(),n.deleteZoneId=null},this.deleteZone=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneControll.deleteZone(n.deleteZoneId);case 2:n.deletePopup.remove(),n.deleteZoneId=null;case 4:case"end":return e.stop()}}),e)}))),this.onClickDeleteZone=function(e){var t=n.getZoneFeatureByEvent(e);if(t){var a=t.properties.id;a!==n.deleteZoneId&&(n.deletePopup&&n.deletePopup.remove(),n.showDeletePopup(a),n.deleteZoneId=a)}},this.cursorListener=function(e){var t=n.getZoneFeatureByEvent(e);n.map.getCanvas().style.cursor=t?"pointer":""},this.zoneControll=t,this.zoneApi=new Ze}return Object(u.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group",this.createButton=ke('\n\t<svg version="1.1" viewBox="0 0 42 42">\n\t\t<path d="M37.059,16H26V4.941C26,2.224,23.718,0,21,0s-5,2.224-5,4.941V16H4.941C2.224,16,0,18.282,0,21s2.224,5,4.941,5H16v11.059\n\t\tC16,39.776,18.282,42,21,42s5-2.224,5-4.941V26h11.059C39.776,26,42,23.718,42,21S39.776,16,37.059,16z" />\n\t</svg>\n\t',this.onClickCreateButton),this.deleteButton=ke('\n\t<svg version="1.1" viewBox="0 0 384 384">\n\t\t<path\n\t\td="M64,341.333C64,364.907,83.093,384,106.667,384h170.667C300.907,384,320,364.907,320,341.333v-256H64V341.333z" />\n\t\t<polygon\n\t\tpoints="266.667,21.333 245.333,0 138.667,0 117.333,21.333 42.667,21.333 42.667,64 341.333,64 341.333,21.333 \t\t\t" />\n\t</svg>\n\t',this.onClickDeleteButton),this.editButton=ke('\n\t<svg version="1.1" viewBox="0 0 383.947 383.947">\n\t\t<polygon points="0,303.947 0,383.947 80,383.947 316.053,147.893 236.053,67.893" />\n\t\t<path\n\t\td="M377.707,56.053L327.893,6.24c-8.32-8.32-21.867-8.32-30.187,0l-39.04,39.04l80,80l39.04-39.04C386.027,77.92,386.027,64.373,377.707,56.053z" />\n\t</svg>\n\t',this.onClickEditButton),this.container.appendChild(this.createButton),this.container.appendChild(this.deleteButton),this.container.appendChild(this.editButton),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.disableAllModes(),this.map=void 0}},{key:"updateEditZoneLayer",value:function(){!this.editZone||this.editZone.coordinates.length<4||this.drawEditLayer.update(this.editZone.coordinates)}},{key:"showEditPopup",value:function(){var e=q(this.editZone.coordinates);if(e){var t=document.createElement("div");this.editPopup=new v.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(e).setDOMContent(t).addTo(this.map),i.a.render(o.a.createElement(Ie,{color:this.editZone.color,name:this.editZone.name,onChangeName:this.editZoneName,onChangeColor:this.editZoneColor,onClickCancel:this.cancelEditZone,onClickSave:this.onSaveEdit,onClickEdit:this.onGeometryEdit}),t)}}},{key:"enableCreateMode",value:function(){this.newZone={name:"",color:"#008888",id:null,coordinates:[]};var e=Date.now().toString(36)+Math.random().toString(36).substr(2);this.newZone.id=e,this.map&&(this.drawlayer=new je(this.map,e)),this.newZonelayer=new ge(this.map,e),this.map&&this.map.once("mousedown",this.onMouseDownCreate),be(this.createButton),$(this.map),K(this.map),this.isCreateMode=!0}},{key:"updateColorInNewZone",value:function(){this.newZonelayer.setColor(this.newZone.color)}},{key:"showCreatePopup",value:function(){var e=q(this.newZone.coordinates);if(e){var t=document.createElement("div");this.createPopup=new v.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(e).setDOMContent(t).addTo(this.map);var n=this.zoneControll.getNewZoneName();this.newZone.name=n,i.a.render(o.a.createElement(Se,{name:n,color:null,onChangeName:this.setNewZoneName,onChangeColor:this.setNewZoneColor,onClickCancel:this.disableCreateMode,onClickSave:this.createZone}),t)}}},{key:"updateNewZoneLayer",value:function(){this.newZone.coordinates.length<4||this.drawlayer.update(this.newZone.coordinates,!0)}},{key:"enableDeletetingMode",value:function(){this.map&&this.map.on("click",this.onClickDeleteZone),be(this.deleteButton),this.addCursorPointerListener(),this.isDeleteMode=!0}},{key:"disableDeleteMode",value:function(){this.map&&this.map.off("click",this.onClickDeleteZone),Ce(this.deleteButton),this.deletePopup&&(this.deletePopup.remove(),this.deletePopup=null),this.removeCursorPointerListener(),this.isDeleteMode=!1,this.deleteZoneId=null}},{key:"showDeletePopup",value:function(e){var t=this.zoneControll.getZoneById(e);if(t){var n=q(t.coordinates);if(n){var a=document.createElement("div");this.deletePopup=new v.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(n).setDOMContent(a).addTo(this.map),i.a.render(o.a.createElement(Oe,{name:t.name,onClickCancel:this.cancelDeleteZone,onClickDelete:this.deleteZone}),a)}}}},{key:"addCursorPointerListener",value:function(){this.map.on("mousemove",this.cursorListener)}},{key:"removeCursorPointerListener",value:function(){this.map.off("mousemove",this.cursorListener)}},{key:"disableAllModes",value:function(){this.isEditMode&&this.disableEditMode(),this.isDeleteMode&&this.disableDeleteMode(),this.isCreateMode&&this.disableCreateMode()}},{key:"getZoneFeatureByEvent",value:function(e){var t=this.map.queryRenderedFeatures(e.point);if(t.length){var n=t.shift();if(n)return n.layer.id.match(this.zoneLayerPatternId)?n:void 0}}}]),e}(),ze=function(){function e(t){var n=this;Object(c.a)(this,e),this.zones=[],this.selectedZones=[],this.zoneApi=new Ze,this.layers=new Map,this.init=Object(g.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneApi.getZoneList();case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:n.zones=t,n.drawZones();case 7:case"end":return e.stop()}}),e)}))),this.selectedZones=t}return Object(u.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",e.on("load",this.init),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.map=void 0}},{key:"updateSelectedZones",value:function(e){this.selectedZones=e,this.drawZones()}},{key:"deleteZone",value:function(){var e=Object(g.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.deleteZone(t);case 2:if(this.zones=this.zones.filter((function(e){return e.id!==t})),n=this.layers.get(t)){e.next=6;break}return e.abrupt("return");case 6:n.remove(),this.layers.delete(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateZone",value:function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.updateZone(t);case 2:this.zones=this.zones.map((function(e){return e.id===t.id?t:e})),this.drawZones();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createZone",value:function(){var e=Object(g.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.addZone(t);case 2:this.zones.push(t),this.drawZones();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getZoneList",value:function(){return this.zones}},{key:"getZoneById",value:function(e){return this.zones.find((function(t){return t.id===e}))}},{key:"updateZoneColor",value:function(e,t){var n=this.layers.get(e);n&&n.setColor(t)}},{key:"updateZoneCoordinates",value:function(e,t){var n=this.layers.get(e);n&&n.update(t,!0)}},{key:"removeZoneLayer",value:function(e){var t=this.layers.get(e);t&&t.remove()}},{key:"getNewZoneName",value:function(){return"Zone ".concat(this.zones.length+1)}},{key:"drawZones",value:function(){var e=this;this.zones.forEach((function(t){var n=e.layers.get(t.id);if(n)n.update(t.coordinates),n.setColor(t.color),n.updateName(t.name),e.selectedZones.includes(t.id)?n.addHighlight():n.removeHighlight();else{var a=new ge(e.map,t.id,{color:t.color,name:t.name});a.update(t.coordinates),e.selectedZones.includes(t.id)&&a.addHighlight(),e.layers.set(t.id,a)}}))}}]),e}(),Ne=(n(51),n(52),{Bengaluru:new v.a.LngLat(77.59094323372614,12.975557791300176)}),Pe=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.mapStyle,n=e.mapToken,a=e.isAdmin,o=e.cityCoor,r=e.selectedZones;v.a.accessToken=n,this.map=new v.a.Map({container:L,style:t,center:o,zoom:12}),this.zoneControll=new ze(r),this.map.addControl(this.zoneControll),this.userControll=new ve(this.zoneControll),this.adminControll=new xe(this.zoneControll),a?this.map.addControl(this.adminControll):this.map.addControl(this.userControll)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.isAdmin,a=t.selectedZones;if(n!==e.isAdmin){if(!this.map)return;n?(this.map.removeControl(this.userControll),this.map.addControl(this.adminControll)):(this.map.removeControl(this.adminControll),this.map.addControl(this.userControll))}p.a.isEqual(a,e.selectedZones)||this.zoneControll.updateSelectedZones(a)}},{key:"render",value:function(){return o.a.createElement("div",{id:L})}}]),n}(o.a.Component);Pe.defaultProps={mapStyle:"mapbox://styles/mapbox/streets-v11",isAdmin:!1,cityCoor:Ne.Bengaluru,selectedZones:[]};n(53);var De=function(e){var t=e.selectedZones,n=e.setSelectedZones,r=Object(a.useState)([]),i=Object(s.a)(r,2),c=i[0],u=i[1];Object(a.useEffect)((function(){var e=new Ze;(function(){var t=Object(g.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getZoneList();case 2:(n=t.sent)&&u(n);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]);var l=function(e){var a=e.target.value,o=[];o=t.includes(a)?t.filter((function(e){return e!==a})):[].concat(Object(Le.a)(t),[a]),n(o)};return o.a.createElement("div",{className:"test-zone-list"},"Zones list:",c.map((function(e){return o.a.createElement("label",{key:e.id},o.a.createElement("input",{type:"checkbox",checked:t.includes(e.id),value:e.id,onChange:l}),e.name)})))},Be=function(){var e=Object(a.useState)("user"),t=Object(s.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)([]),c=Object(s.a)(i,2),u=c[0],l=c[1];return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"test-panel"},o.a.createElement("button",{onClick:function(){return r("admin")},className:"admin"===n?"test-panel__button-active":""},"ADMIN MODE"),o.a.createElement("button",{onClick:function(){return r("user")},className:"user"===n?"test-panel__button-active":""},"USER MODE"),o.a.createElement("button",{onClick:function(){return r("highlight")},className:"highlight"===n?"test-panel__button-active":""},"HIGHLIGHT ZONE")),"highlight"===n&&o.a.createElement(De,{selectedZones:u,setSelectedZones:l}),o.a.createElement(Pe,{mapToken:"pk.eyJ1IjoicG9zdGFtZW50b3ZpY2giLCJhIjoiY2p5bjl1M2IyMHBmYjNkbm81YmdpNmxvdSJ9.IiDCsFdJXwFRW2TBlLqh6A",isAdmin:"admin"===n,selectedZones:u}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Be,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.58821cdc.chunk.js.map