(this["webpackJsonpmap-with-zones"]=this["webpackJsonpmap-with-zones"]||[]).push([[0],{16:function(e,t,n){e.exports=n(27)},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var o=n(4),a=n.n(o),i=n(13),r=n.n(i),s=n(14),u=n(1),c=n(2),d=n(10),l=n(9),p=n(6),h=n.n(p),m=n(0),v=n.n(m),f=n(3),y=n(5),g="mapbox-container-element-id",k="".concat("map-controll","__button"),C="".concat(k,"_active"),b="".concat("map-popup","__button"),I="".concat("map-popup","__input"),L="".concat("map-popup","__label"),Z="".concat("map-popup","__title"),w="".concat("map-popup","__color"),E="".concat("map-popup","__controls"),M="".concat("map-table","__title"),S="".concat("map-table","__zones");function B(e,t){var n=document.createElement("button");return n.className=k,n.innerHTML=e,n.addEventListener("click",t),n}function P(e){e.classList.contains(C)&&e.classList.remove(C)}function z(e){e.classList.contains(C)||e.classList.add(C)}function O(e,t,n){var o=document.getElementById(e);o&&o.addEventListener(t,n)}function j(e,t){return'\n        <div class="'.concat(w,'">\n            <label for="').concat(t,'" class="').concat(L,'">Select zone color:</label>\n            <input type="color" id="').concat(t,'" value="').concat(e||"#008888",'" />\n        </div>\n        ')}function x(e,t){return'<button id="'.concat(t,'" class="').concat(b,'">').concat(e||" ","</button>")}function D(e,t){return"\n        <label for=".concat(t,' class="').concat(L,'">Enter zone name:</label></br>\n        <input type="text" id="').concat(t,'" value="').concat(e||" ",'" class="').concat(I,'" /></br>')}function N(e){var t=document.getElementById(M);t&&(t.innerText=e)}function A(e){var t=document.getElementById(S);t&&(t.innerHTML=e.map((function(e){return"<span>".concat(e.name,"</span>")})).join(" "))}var _="dragend",T="radiusChanged",R="buttonClick",H=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(e){var o;return Object(u.a)(this,n),(o=t.call(this)).radiusInputId="marker-input-radius",o.radiusButtonId="marker-button-radius",o.onInputChange=function(e){o.fire(T,{radius:Number(e.target.value)})},o.onDragEnd=function(){var e=o.marker.getLngLat();o.fire(_,{lngLat:e})},o.onButtonClick=function(){o.fire(R)},o.map=e,o.marker=new h.a.Marker({draggable:!0}),o.popup=new h.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setHTML(o.getPopupContent()),o}return Object(c.a)(n,[{key:"subscribeToPopup",value:function(){O(this.radiusInputId,"change",this.onInputChange),O(this.radiusButtonId,"click",this.onButtonClick)}},{key:"getPopupContent",value:function(){return"\n        <div class=".concat("map-popup",">\n            ").concat((e=1,t=this.radiusInputId,"\n        <label for=".concat(t,' class="').concat(L,'">Enter radius (km):</label></br>\n        <input type="number" id="').concat(t,'" value="').concat(e||0,'" class="').concat(I,'" /></br>')),'\n            <div class="').concat(E,'">\n                ').concat(x("Select",this.radiusButtonId),"\n            </div>\n        </div>\n        ");var e,t}},{key:"remove",value:function(){this.marker&&this.marker.remove(),this.popup&&this.popup.remove()}},{key:"update",value:function(e){this.marker.setLngLat(e.toArray()),this.marker.setPopup(this.popup),this.marker.addTo(this.map),this.marker.togglePopup(),this.subscribeToPopup(),this.marker.on("dragend",this.onDragEnd)}}]),n}(h.a.Evented);function J(e){if(!(e.length<2)){var t=y.lineString(e),n=y.lineToPolygon(t);return y.centerOfMass(n)}}function U(e){var t=J(e);if(t)return y.getCoord(t)}function F(e,t){var n=G(e,t);if(n&&!(n.geometry.coordinates.length<4))return y.lineToPolygon(n)}function G(e,t){var n=y.lineString(e,{id:t}),o=y.simplify(n,{tolerance:1e-5});if(!(o.geometry.coordinates.length<4)){var a=y.lineToPolygon(o);return y.polygonToLine(a)}}function Y(e,t){return y.circle(e.toArray(),t)}var V=function(){function e(t){Object(u.a)(this,e),this.map=t,this.layerId="radius-stroke-layer",this.sourceId="radius-stroke-source"}return Object(c.a)(e,[{key:"update",value:function(e,t){this.addSource(e,t),this.addLayer()}},{key:"addSource",value:function(e,t){var n=function(e,t){if(e&&t){var n=y.circle(e.toArray(),t);return y.polygonToLine(n)}}(t,e);if(n){var o=this.getSource();if(o)return o.setData(n);this.map.addSource(this.sourceId,{type:"geojson",data:n})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#292828","line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6],"line-dasharray":[5,3]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),W=function(){function e(t){Object(u.a)(this,e),this.layerId="radius-layer",this.sourceId="radius-source",this.map=t,this.strokeLayer=new V(t)}return Object(c.a)(e,[{key:"update",value:function(e,t){e>0?(this.addSource(e,t),this.addLayer(),this.strokeLayer.update(e,t)):this.remove()}},{key:"addSource",value:function(e,t){var n=this.getSource(),o=Y(t,e);n?n.setData(o):this.map.addSource(this.sourceId,{type:"geojson",data:o})}},{key:"addLayer",value:function(){this.gerLayer()||this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",paint:{"fill-color":"#292828","fill-opacity":.4}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}();function q(){return X.apply(this,arguments)}function X(){return(X=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),100)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=function(){function e(){Object(u.a)(this,e)}return Object(c.a)(e,[{key:"sendInfoAboutIncludedZones",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:console.log(t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),K=function(){function e(t){var n=this;Object(u.a)(this,e),this.data={lngLat:null,radius:1,zones:[]},this.onButtonClick=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.userApi.sendInfoAboutIncludedZones(n.data);case 2:case"end":return e.stop()}}),e)}))),this.onRadiusChanged=function(e){var t=e.radius;n.data.radius=t,n.updateRadiusLayer(),n.findZonesInRadius()},this.onDragEndMarker=function(e){var t=e.lngLat;n.data.lngLat=t,n.updateRadiusLayer(),n.findZonesInRadius()},this.onMapClick=function(e){n.markerLayer.update(e.lngLat),n.data.lngLat=e.lngLat,n.findZonesInRadius(),n.updateRadiusLayer(),N("You have selected the following zones:")},this.zoneControll=t,this.userApi=new $}return Object(c.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",this.enableUserMode(),this.container}},{key:"onRemove",value:function(){this.disableUserMode(),this.container.parentNode.removeChild(this.container),this.data={lngLat:null,radius:1,zones:[]},this.map=void 0}},{key:"disableUserMode",value:function(){this.markerLayer&&this.markerLayer.remove(),this.radiusLayer&&this.radiusLayer.remove(),this.map.off("click",this.onMapClick),function(){var e=document.getElementById("map-table");e&&e.remove()}()}},{key:"enableUserMode",value:function(){this.markerLayer=new H(this.map),this.radiusLayer=new W(this.map),this.markerLayer.on(_,this.onDragEndMarker),this.markerLayer.on(T,this.onRadiusChanged),this.markerLayer.on(R,this.onButtonClick),this.map.once("click",this.onMapClick),function(){var e=document.getElementById(g);if(e){var t=document.createElement("div");t.className="map-table",t.id="map-table";var n=document.createElement("span");n.className=M,n.id=M;var o=document.createElement("div");o.className=S,o.id=S,t.appendChild(n),t.appendChild(o),e.appendChild(t)}}(),N("Set point on the map")}},{key:"findZonesInRadius",value:function(){if(!this.data.lngLat||!this.data.radius)return A([]);var e=Y(this.data.lngLat,this.data.radius),t=this.zoneControll.getZoneList().filter((function(t){var n=F(t.coordinates,t.id);return!!y.intersect(e,n)}));this.data.zones=t.map((function(e){return{name:e.name,id:e.id}})),A(t)}},{key:"updateRadiusLayer",value:function(){this.data.lngLat&&this.radiusLayer.update(this.data.radius,this.data.lngLat)}}]),e}(),Q=n(11),ee=n.n(Q),te=function(){function e(t,n,o){Object(u.a)(this,e);var a=o&&o.color||"#008888";this.map=t,this.layerId="zone-stroke-layer-".concat(n),this.sourceId="zone-stroke-source-".concat(n),this.id=n,this.color=a}return Object(c.a)(e,[{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"setColor",value:function(e){this.color=e,this.map.setPaintProperty(this.layerId,"line-color",e)}},{key:"addSource",value:function(e){var t=G(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":this.color,"line-width":["interpolate",["exponential",1.5],["zoom"],5,1,16,6]}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),ne=function(){function e(t,n,o){Object(u.a)(this,e),this.name=o&&o.name?o.name:" ",this.map=t,this.layerId="zone-name-layer-".concat(n),this.sourceId="zone-name-source-".concat(n),this.id=n}return Object(c.a)(e,[{key:"updateName",value:function(e){this.name=e,this.map.setLayoutProperty(this.layerId,"text-field",e)}},{key:"update",value:function(e){this.addSource(e),this.addLayer()}},{key:"addSource",value:function(e){var t=J(e);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,minzoom:12,type:"symbol",layout:{"text-field":this.name,"text-size":["interpolate",["exponential",1.5],["zoom"],12,12,18,46]},paint:{"text-color":"white"}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId)}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}(),oe=function(){function e(t,n,o){Object(u.a)(this,e),this.map=t,this.layerId="zone-layer-".concat(n),this.sourceId="zone-source-".concat(n),this.id=n,this.color=o&&o.color||"#008888",this.strokeLayer=new te(t,n,o),this.nameLayer=new ne(t,n,o)}return Object(c.a)(e,[{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addSource(e),this.addLayer(),this.strokeLayer.update(e),t||this.nameLayer.update(e)}},{key:"updateName",value:function(e){this.nameLayer.updateName(e)}},{key:"setColor",value:function(e){this.color=e,this.map.setPaintProperty(this.layerId,"fill-color",e),this.strokeLayer.setColor(e)}},{key:"addSource",value:function(e){var t=F(e,this.id);if(t){var n=this.getSource();if(n)return n.setData(t);this.map.addSource(this.sourceId,{type:"geojson",data:t})}}},{key:"addLayer",value:function(){!this.gerLayer()&&this.getSource()&&this.map.addLayer({id:this.layerId,source:this.sourceId,type:"fill",layout:{},paint:{"fill-color":this.color,"fill-opacity":.5,"fill-outline-color":"transparent"}})}},{key:"remove",value:function(){this.gerLayer()&&this.map.removeLayer(this.layerId),this.getSource()&&this.map.removeSource(this.sourceId),this.strokeLayer.remove(),this.nameLayer.remove()}},{key:"getSource",value:function(){return this.map.getSource(this.sourceId)}},{key:"gerLayer",value:function(){return this.map.getLayer(this.layerId)}}]),e}();function ae(e){e&&(e.dragPan.enable(),e.boxZoom.enable(),e.scrollZoom.enable(),e.dragRotate.enable(),e.doubleClickZoom.enable(),e.touchZoomRotate.enable(),e.touchPitch.enable())}function ie(e){e&&(e.dragPan.disable(),e.boxZoom.disable(),e.scrollZoom.disable(),e.dragRotate.disable(),e.doubleClickZoom.disable(),e.touchZoomRotate.disable(),e.touchPitch.disable())}var re=n(15),se=function(){function e(){Object(u.a)(this,e),this.localStoragekey="mapZones"}return Object(c.a)(e,[{key:"getZoneList",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:if(t=localStorage.getItem(this.localStoragekey)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",JSON.parse(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n,o,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:return n=[],e.next=5,this.getZoneList();case 5:(o=e.sent)&&(n=Object(re.a)(o)),n.push(t),a=JSON.stringify(n),localStorage.setItem(this.localStoragekey,a);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n,o,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:return e.next=4,this.getZoneList();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:o=n.map((function(e){return e.id===t.id?t:e})),a=JSON.stringify(o),localStorage.setItem(this.localStoragekey,a);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n,o,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q();case 2:return e.next=4,this.getZoneList();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:o=n.filter((function(e){return e.id!==t})),a=JSON.stringify(o),localStorage.setItem(this.localStoragekey,a);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ue=function(){function e(t){var n=this;Object(u.a)(this,e),this.isCreateMode=!1,this.isEditMode=!1,this.isDeleteMode=!1,this.deleteZoneId=null,this.editZoneId=null,this.cacheZone=null,this.newZone={name:"",color:"#008888",id:null,coordinates:[]},this.popupCreateId="".concat("map-controll","__popup-create"),this.popupCreateInputNameId="".concat(this.popupCreateId,"-input-name"),this.popupCreateInputColorId="".concat(this.popupCreateId,"-input-color"),this.popupCreateButtonSaveId="".concat(this.popupCreateId,"-button-save"),this.popupCreateButtonCancelId="".concat(this.popupCreateId,"-button-cancel"),this.popupDeleteId="".concat("map-controll","__popup-delete"),this.popupDeleteButtonConfirmId="".concat(this.popupDeleteId,"-button-confirm"),this.popupDeleteButtonCancelId="".concat(this.popupDeleteId,"-button-cancel"),this.popupEditId="".concat("map-controll","__popup-edit"),this.popupEditInputNameId="".concat(this.popupEditId,"-input-name"),this.popupEditInputColorId="".concat(this.popupEditId,"-input-color"),this.popupEditButtonSaveId="".concat(this.popupEditId,"-button-save"),this.popupEditButtonCancelId="".concat(this.popupEditId,"-button-cancel"),this.popupEditButtonGeometryId="".concat(this.popupEditId,"-button-geometry"),this.zoneLayerPatternId=/zone-layer-\w/i,this.onClickEditButton=function(){if(n.isEditMode)return n.disableEditMode();n.disableAllModes(),n.enableEditMode()},this.onMouseUpEdit=function(e){n.map.off("mousemove",n.onMouseMoveEdit),n.editZone&&n.showEditPopup(n.editZone.id),ae(n.map)},this.onMouseMoveEdit=function(e){n.editZone&&(n.editZone.coordinates.push(e.lngLat.toArray()),n.updateEditZoneLayer())},this.onMouseDownEdit=function(e){n.map.on("mousemove",n.onMouseMoveEdit),n.map.once("mouseup",n.onMouseUpEdit)},this.onGeometryEdit=function(){n.editPopup&&n.editPopup.remove(),ie(n.map),n.zoneControll.removeZoneLayer(n.editZone.id),n.editZone.coordinates=[],n.map.on("mousedown",n.onMouseDownEdit)},this.cancelEditZone=function(){n.zoneControll.drawZones(),n.editPopup&&n.editPopup.remove(),n.editZone=null},this.onSaveEdit=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneControll.updateZone(n.editZone);case 2:n.editPopup&&n.editPopup.remove(),n.editZone=null;case 4:case"end":return e.stop()}}),e)}))),this.editZoneColor=function(e){var t=e.target.value;n.editZone.color=t,n.zoneControll.updateZoneColor(n.editZone.id,t)},this.editZoneName=function(e){n.editZone.name=e.target.value},this.onClickEdit=function(e){var t=n.getZoneFeatureByEvent(e);if(t){var o=t.properties.id;if(!n.editZone||o!==n.editZone.id){n.editPopup&&n.editPopup.remove();var a=n.zoneControll.getZoneById(o);n.editZone=ee.a.cloneDeep(a),n.showEditPopup()}}},this.enableEditMode=function(){z(n.editButton),n.addCursorPointerListener(),n.map.on("click",n.onClickEdit),n.isEditMode=!0},this.disableEditMode=function(){P(n.editButton),n.removeCursorPointerListener(),n.map.off("click",n.onClickEdit),n.cancelEditZone(),n.editZone=null,n.isEditMode=!1},this.onClickCreateButton=function(){if(n.isCreateMode)return n.disableCreateMode();n.disableAllModes(),n.enableCreateMode()},this.disableCreateMode=function(){n.newZone={name:"",color:"#008888",id:null,coordinates:[]},n.createPopup&&n.createPopup.remove(),n.newZonelayer&&n.newZonelayer.remove(),P(n.createButton),ae(n.map),n.isCreateMode=!1},this.setNewZoneName=function(e){n.newZone.name=e.target.value},this.setNewZoneColor=function(e){n.newZone.color=e.target.value,n.updateColorInNewZone()},this.createZone=function(){var e=ee.a.cloneDeep(n.newZone);n.zoneControll.createZone(e),n.onClickCreateButton(),n.createPopup.remove(),n.newZonelayer.remove(),n.newZone={name:"",color:"#008888",id:null,coordinates:[]}},this.onMouseUpCreate=function(e){n.map.off("mousemove",n.onMouseMoveCreate),n.showCreatePopup()},this.onMouseMoveCreate=function(e){n.newZone.coordinates.push(e.lngLat.toArray()),n.updateNewZoneLayer()},this.onMouseDownCreate=function(e){n.newZone.coordinates.push(e.lngLat.toArray()),n.map.on("mousemove",n.onMouseMoveCreate),n.map.once("mouseup",n.onMouseUpCreate)},this.cancelDeleteZone=function(){n.deletePopup.remove(),n.deleteZoneId=null},this.deleteZone=function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoneControll.deleteZone(t);case 2:n.deletePopup.remove();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onClickDeleteZone=function(e){var t=n.getZoneFeatureByEvent(e);if(t){var o=t.properties.id;o!==n.deleteZoneId&&(n.deletePopup&&n.deletePopup.remove(),n.showDeletePopup(o),n.deleteZoneId=o)}},this.onClickDeleteButton=function(){if(n.isDeleteMode)return n.disableDeleteMode();n.disableAllModes(),n.enableDeletetingMode()},this.cursorListener=function(e){var t=n.getZoneFeatureByEvent(e);n.map.getCanvas().style.cursor=t?"pointer":""},this.zoneControll=t,this.zoneApi=new se}return Object(c.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl mapboxgl-ctrl-group",this.createButton=B('\n\t<svg version="1.1" viewBox="0 0 42 42">\n\t\t<path d="M37.059,16H26V4.941C26,2.224,23.718,0,21,0s-5,2.224-5,4.941V16H4.941C2.224,16,0,18.282,0,21s2.224,5,4.941,5H16v11.059\n\t\tC16,39.776,18.282,42,21,42s5-2.224,5-4.941V26h11.059C39.776,26,42,23.718,42,21S39.776,16,37.059,16z" />\n\t</svg>\n\t',this.onClickCreateButton),this.deleteButton=B('\n\t<svg version="1.1" viewBox="0 0 384 384">\n\t\t<path\n\t\td="M64,341.333C64,364.907,83.093,384,106.667,384h170.667C300.907,384,320,364.907,320,341.333v-256H64V341.333z" />\n\t\t<polygon\n\t\tpoints="266.667,21.333 245.333,0 138.667,0 117.333,21.333 42.667,21.333 42.667,64 341.333,64 341.333,21.333 \t\t\t" />\n\t</svg>\n\t',this.onClickDeleteButton),this.editButton=B('\n\t<svg version="1.1" viewBox="0 0 383.947 383.947">\n\t\t<polygon points="0,303.947 0,383.947 80,383.947 316.053,147.893 236.053,67.893" />\n\t\t<path\n\t\td="M377.707,56.053L327.893,6.24c-8.32-8.32-21.867-8.32-30.187,0l-39.04,39.04l80,80l39.04-39.04C386.027,77.92,386.027,64.373,377.707,56.053z" />\n\t</svg>\n\t',this.onClickEditButton),this.container.appendChild(this.createButton),this.container.appendChild(this.deleteButton),this.container.appendChild(this.editButton),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.disableAllModes(),this.map=void 0}},{key:"addEditPopupListeners",value:function(){O(this.popupEditInputNameId,"change",this.editZoneName),O(this.popupEditInputColorId,"change",this.editZoneColor),O(this.popupEditButtonSaveId,"click",this.onSaveEdit),O(this.popupEditButtonCancelId,"click",this.cancelEditZone),O(this.popupEditButtonGeometryId,"click",this.onGeometryEdit)}},{key:"updateEditZoneLayer",value:function(){!this.editZone||this.editZone.coordinates.length<4||this.zoneControll.updateZoneCoordinates(this.editZone.id,this.editZone.coordinates)}},{key:"getEditPopupContent",value:function(e){var t=e.name,n=e.color;return'\n            <div class="'.concat("map-popup",'">\n                ').concat(D(t,this.popupEditInputNameId),"\n                ").concat(j(n,this.popupEditInputColorId),"\n                ").concat(x("Edit Geometry",this.popupEditButtonGeometryId),'\n                <div class="').concat(E,'">\n                ').concat(x("Cancel",this.popupEditButtonCancelId),"\n                ").concat(x("Save",this.popupEditButtonSaveId),"\n                </div>\n            </div>")}},{key:"showEditPopup",value:function(){var e=U(this.editZone.coordinates);e&&(this.editPopup=new h.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(e).setHTML(this.getEditPopupContent(this.editZone)).addTo(this.map),this.addEditPopupListeners())}},{key:"enableCreateMode",value:function(){this.newZone={name:"",color:"#008888",id:null,coordinates:[]};var e=Date.now().toString(36)+Math.random().toString(36).substr(2);this.newZone.id=e,this.newZonelayer=new oe(this.map,e),this.map.once("mousedown",this.onMouseDownCreate),z(this.createButton),ie(this.map),this.isCreateMode=!0}},{key:"showCreatePopup",value:function(){var e=U(this.newZone.coordinates);e&&(this.createPopup=new h.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(e).setHTML(this.getCreatePopupContent()).addTo(this.map),this.addCreatePopupListners())}},{key:"addCreatePopupListners",value:function(){O(this.popupCreateInputNameId,"change",this.setNewZoneName),O(this.popupCreateInputColorId,"change",this.setNewZoneColor),O(this.popupCreateButtonCancelId,"click",this.disableCreateMode),O(this.popupCreateButtonSaveId,"click",this.createZone)}},{key:"updateColorInNewZone",value:function(){this.newZonelayer.setColor(this.newZone.color)}},{key:"getCreatePopupContent",value:function(){var e=this.zoneControll.getNewZoneName();return this.newZone.name=e,"\n            <div class=".concat("map-popup",">\n                ").concat(D(e,this.popupCreateInputNameId),"\n                ").concat(j(null,this.popupCreateInputColorId),'\n                <div class="').concat(E,'">\n                ').concat(x("Cancel",this.popupCreateButtonCancelId),"\n                ").concat(x("Save",this.popupCreateButtonSaveId),"\n                </div>\n            </div>")}},{key:"updateNewZoneLayer",value:function(){this.newZone.coordinates.length<4||this.newZonelayer.update(this.newZone.coordinates,!0)}},{key:"getDeletePopupContent",value:function(e){return"\n            <div class=".concat("map-popup",">\n                ").concat((t="Do you want to delete a zone ".concat(e,"?"),'<span class="'.concat(Z,'">').concat(t||" ","</span>")),'\n                <div class="').concat(E,'">\n                ').concat(x("Cancel",this.popupDeleteButtonCancelId),"\n                ").concat(x("Delete",this.popupDeleteButtonConfirmId),"\n                </div>\n            </div>");var t}},{key:"addDeletePopupListeners",value:function(e){var t=this;O(this.popupDeleteButtonConfirmId,"click",(function(){return t.deleteZone(e)})),O(this.popupDeleteButtonCancelId,"click",this.cancelDeleteZone)}},{key:"showDeletePopup",value:function(e){var t=this.zoneControll.getZoneById(e);if(t){var n=U(t.coordinates);n&&(this.deletePopup=new h.a.Popup({closeButton:!1,closeOnClick:!1,closeOnMove:!1}).setLngLat(n).setHTML(this.getDeletePopupContent(t.name)).addTo(this.map),this.addDeletePopupListeners(t.id))}}},{key:"enableDeletetingMode",value:function(){this.map.on("click",this.onClickDeleteZone),z(this.deleteButton),this.addCursorPointerListener(),this.isDeleteMode=!0}},{key:"disableDeleteMode",value:function(){this.map.off("click",this.onClickDeleteZone),P(this.deleteButton),this.deletePopup&&(this.deletePopup.remove(),this.deletePopup=null),this.removeCursorPointerListener(),this.isDeleteMode=!1,this.deleteZoneId=null}},{key:"addCursorPointerListener",value:function(){this.map.on("mousemove",this.cursorListener)}},{key:"removeCursorPointerListener",value:function(){this.map.off("mousemove",this.cursorListener)}},{key:"disableAllModes",value:function(){this.isEditMode&&this.disableEditMode(),this.isDeleteMode&&this.disableDeleteMode(),this.isCreateMode&&this.disableCreateMode()}},{key:"getZoneFeatureByEvent",value:function(e){var t=this.map.queryRenderedFeatures(e.point);if(t.length){var n=t.shift();if(n)return n.layer.id.match(this.zoneLayerPatternId)?n:void 0}}}]),e}(),ce=(n(24),n(25),function(){function e(){var t=this;Object(u.a)(this,e),this.zones=[],this.zoneApi=new se,this.layers=new Map,this.init=Object(f.a)(v.a.mark((function e(){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.zoneApi.getZoneList();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:t.zones=n,t.drawZones();case 7:case"end":return e.stop()}}),e)})))}return Object(c.a)(e,[{key:"onAdd",value:function(e){return this.map=e,this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",e.on("load",this.init),this.container}},{key:"onRemove",value:function(){this.container.parentNode.removeChild(this.container),this.map=void 0}},{key:"deleteZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.deleteZone(t);case 2:if(this.zones=this.zones.filter((function(e){return e.id!==t})),n=this.layers.get(t)){e.next=6;break}return e.abrupt("return");case 6:n.remove(),this.layers.delete(t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.updateZone(t);case 2:this.zones=this.zones.map((function(e){return e.id===t.id?t:e})),this.drawZones();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createZone",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.zoneApi.addZone(t);case 2:this.zones.push(t),this.drawZones();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getZoneList",value:function(){return this.zones}},{key:"getZoneById",value:function(e){return this.zones.find((function(t){return t.id===e}))}},{key:"updateZoneColor",value:function(e,t){var n=this.layers.get(e);n&&n.setColor(t)}},{key:"updateZoneCoordinates",value:function(e,t){var n=this.layers.get(e);n&&n.update(t,!0)}},{key:"removeZoneLayer",value:function(e){var t=this.layers.get(e);t&&t.remove()}},{key:"getNewZoneName",value:function(){return"Zone ".concat(this.zones.length+1)}},{key:"drawZones",value:function(){var e=this;this.zones.forEach((function(t){var n=e.layers.get(t.id);if(n)n.update(t.coordinates),n.setColor(t.color),n.updateName(t.name);else{var o=new oe(e.map,t.id,{color:t.color,name:t.name});o.update(t.coordinates),e.layers.set(t.id,o)}}))}}]),e}()),de={Bengaluru:new h.a.LngLat(77.59094323372614,12.975557791300176)},le=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.mapStyle,n=e.mapToken,o=e.isAdmin,a=e.cityCoor;h.a.accessToken=n;var i=t||"mapbox://styles/mapbox/streets-v11";this.map=new h.a.Map({container:g,style:i,center:a,zoom:12}),this.zoneControll=new ce,this.map.addControl(this.zoneControll),this.userControll=new K(this.zoneControll),this.adminControll=new ue(this.zoneControll),o?this.map.addControl(this.adminControll):this.map.addControl(this.userControll)}},{key:"componentDidUpdate",value:function(e){var t=this.props.isAdmin;if(t!==e.isAdmin){if(!this.map)return;t?(this.map.removeControl(this.userControll),this.map.addControl(this.adminControll)):(this.map.removeControl(this.adminControll),this.map.addControl(this.userControll))}}},{key:"render",value:function(){return a.a.createElement("div",{id:g})}}]),n}(a.a.Component),pe=(n(26),function(){var e=Object(o.useState)(!0),t=Object(s.a)(e,2),n=t[0],i=t[1];return a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"test-panel"},a.a.createElement("button",{onClick:function(){return i(!0)},className:n?"test-panel__button-active":""},"ADMIN MODE"),a.a.createElement("button",{onClick:function(){return i(!1)},className:n?"":"test-panel__button-active"},"USER MODE")),a.a.createElement(le,{mapToken:"pk.eyJ1IjoicG9zdGFtZW50b3ZpY2giLCJhIjoiY2p5bjl1M2IyMHBmYjNkbm81YmdpNmxvdSJ9.IiDCsFdJXwFRW2TBlLqh6A",cityCoor:de.Bengaluru,isAdmin:n}))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(pe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.68c5f16a.chunk.js.map